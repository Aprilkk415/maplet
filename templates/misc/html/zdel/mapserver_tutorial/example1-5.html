{% extends "../../../../theme/content.html" %}

{% block content %}
<div class="content">


    <div class="single">

<h3 align="center"><!--Example 1.5: Adding a Raster Layer-->例1.5：加入光栅层</h3>
          <div align="center">
            <img border="1" src="http://159.226.123.26/cgi-bin/mapserv?map=/mstu/htdocs/example1-5.map&layer=states&layer=states_line&layer=states_label&layer=modis&mode=map" />
          </div>
          <p align="left"><!--In addition to vector data support (point, lines,
            polygons, and annotations), MapServer can also display raster data.
            Through the use of GDAL library, MapServer can input and output
            multiple raster formats. Whereas in versions prior to 4.x raster
            input is limited to single layer, grayscale or indexed color images,
            MapServer now supports RGB and multispectral (multi-layer) images.
            This example shows how to select what layers to display when using
            multispectral data. There might be a noticeable performance hit when
            using RGB and multispectral images.-->
            在除了支持矢量数据（点，线，MapServer的多边形和注释），还可以显示栅格数据。通过GDAL库的使用，地图服务器可以输入和输出多种光栅格式。而在4.0以前的版本光栅输入仅限于单层，灰度或彩色图像索引，现在的MapServer支持RGB和多光谱图像（多层）。这个例子显示了如何使用多光谱数据选择要显示什么样的层。采用RGB和多光谱图像，有可能有一个明显的性能损失。
          </p>
          <p align="left"><!--Because MapServer 5.x uses GD version 2.0.x library to
            generate output images, it supports RGB (24-bit or true color)
            output as well. So, along with 8-bit (indexed color or grayscale)
            PNG, you can now also use PNG24 (true color) for output. This
            example uses PNG24 as IMAGETYPE. As with RGB input, there might be
            a noticeable performance hit when using PNG24.-->
            因为MapServer的5.x的使用GD2.0.x版本库生成图像输出，它支持RGB（24位真彩色）以及输出。因此，你现在可以同时使用PNG24（真彩色）输出和8位（索引颜色或灰度）PNG。这个例子使用PNG24 IMAGETYPE。 就像RGB输入，使用PNG24时，有可能有一个明显的表现。
          </p>
          <p><!--MapServer can actually use GDAL to generate output images as well
            but that's another topic.  If you want to know more about it, look
            at the OUTPUTFORMAT object in the mapfile reference.-->
            MapServer的其实可以使用GDAL生成输出图像以及但是那是另一个话题。关于它如果你想知道更多，看看在OUTPUTFORMAT的映射文件中引用的对象。
          </p>
          <hr>
          <p align="left"><!--This is what the mapfile looks like (Example1-5.map):-->
          下面是本例中用到的Mapfile（Example1-5.map）：

<pre class="brush:py">
# The annotated map file (sort of)
# Created by Pericles S. Nacionales for the MapServer tutorial
# 20050408
#
# MapServer map file uses the pound sign (#) to denote the start of a line
# comment--each line that needs to be commented has to be prepended with a "#".
#
# Map files begin with MAP keyword to signify the start of the map object.
# Well, the entire map file is THE map object.  Enclosed between MAP and END
# at the very bottom of this map file, are keyword/value pairs and other
# objects.
# 注释的地图文件（排序）
# 由伯里克利S. NACIONALES创建的MapServer的教程
# 20050408
#
# MapServer的地图文件使用井号（# ）开头的行表示
# 评论 - 每一行，需要加以评价，必须在前面加上一个“# ”。
#
# 地图文件与MAP关键字开始，意味着开始地图对象。
# 好了，整个地图文件是地图对象。 MAP和END之间封闭
# 在这个地图文件的最底部，关键字/值对和其他
# 对象。
MAP
  IMAGETYPE      PNG24
  EXTENT         -97.238976 41.619778 -82.122902 49.385620
  SIZE           400 300
  SHAPEPATH      "../data"
  IMAGECOLOR     255 255 255
  FONTSET        "../fonts/fonts.list"
  SYMBOLSET      "../symbols/symbols35.sym"

  # Layer objects are defined beneath the map object.  You need at least one
  # layer defined in your map file before you can display a map...  You can
  # define as many layers as you'd like although a limit is typically hard-coded
  # in map.h in the MapServer source.  The default limit is set at 100.  You'd
  # have to have a very specialized application to need more than 100 layers in
  # your application.
  # 层对象在地图下方的对象定义。你至少需要一个
  # 层中定义的地图文件，然后才可以显示在地图...您可以
  # 定义为多层次，只要你愿意，虽然一个限制通常是硬编码
  # 在MapServer的map.h。默认的限额设定为100。你最好
  # 必须有一个非常特殊的应用需要超过100层
  # 您的应用中。
  #
  # Start of LAYER DEFINITIONS ---------------------------------------------
  # 层定义开始---------------------------------------------
  LAYER # States polygon layer begins here
    NAME         states
    DATA         states_ugl
    STATUS       OFF
    TYPE         POLYGON

    # CLASSITEM defines the non-spatial attribute that you will be using to
    # separate a layer into classes.  This attribute will be in the DBF file
    # of your shapefile (it will be different for each data format).  In this
    # example the shapefile states_ugl has an associated database
    # (states_ugl.dbf) that contains an attribute called "CLASS".  You will be
    # using two values in the CLASS attribute to separate the classes (also
    # called themes) used in this layer--land and water.  CLASSITEM is used in
    # association with the EXPRESSION parameter in the CLASS object.  See below.
    # CLASSITEM定义你将使用
    # 的层分离的类的非空间属性。此属性将在你的shape文件中的
    # DBF文件中（每个数据格式会有所不同）。在这种
    # 例如shape文件states_ugl的有一个相关的数据库
    #  （ states_ugl.dbf ） ，其中包含一个被称为“类”的属性。您将
    # 使用两个值中的CLASS属性在这一层分离类（也
    # 称为主题） - 土地和水。 CLASSITEM中使用
    # 与表达参数类对象。见下文。
    CLASSITEM    "CLASS"

    # The class object is defined within the layer object.  You can define as
    # many classes as you need (well, there are limits as with layers, but it's
    # senseless to define more than ten on a "normal" layer.  There are
    # situations, however, where you might have to do it.)
    # 类对象在层对象内定义。您可以定义
    # 你需要的类（尽管在层中限制，但这是
    # 没有意义的在一个“正常”层定义十多个。
    # 有这样的情况，然而，你可能不得不这样做。）
    CLASS
      NAME 'States'
      EXPRESSION 'land'

      # There are styles in a class, just like there are classes in a layer,
      # just like there are layers in a map.  You can define multiple styles in
      # a class just as you can define multiple classes in a layer and multiple
      # layers in a map.
      # 一个类有不同的风格，就像有一层中有不同的类，
      # 就像在一个地图中有多个层。您可以在一个类中定义多个样式
      # ，就像你在一层，可以定义多个类,在一个地图可以定义多个
      # 层。
      STYLE
        COLOR      232 232 232
      END
    END
  END # States polygon layer ends here

  # In addition to vector data (shapefiles are vector data), MapServer supports
  # a host of raster formats.  In GIS world, one of the most common raster
  # formats is GeoTIFF, a TIFF image with geospatial headers.  MapServer also
  # supports JPEG, PNG, GIF, and other common formats.  Other raster formats
  # supported by MapServer include ESRI Arc/Info grid, HDF and HDF-EOS, NetCDF,
  # Generic raster binaries, OGC Web Map Service (WMS) layers, etc.  Pretty much
  # any raster format you can think of is probably supported, thanks to the
  # impressive Geospatial Data Abstraction Library (GDAL, pronounced "GOODALL"
  # or GOODLE?).  More information on GDAL is available at http://www.gdal.org.
  #
  # MapServer 4.x can read and display bitmapped (like GIFs), RGB/A (true
  # color), and multispectral (images with more than 3 bands, like raw LandSat
  # images) rasters.
  # 除了矢量数据（shapefile是矢量数据），MapServer的支持
  # 主机的光栅格式。在GIS中世界，一个最常见的栅格
  # 格式为GeoTIFF，TIFF影像，有一个地理的开头。 MapServer的也
  # 支持JPEG，PNG，GIF等常见格式。
  # MapServer支持的其他光栅格式包括ESRI弧/信息网，HDF和HDF-EOS，NetCDF的，
  # 通用光栅二进制文件，OGC Web地图服务（WMS）层等几乎
  # 你能想到的任何可能是支持的光栅格式，这要归功于
  # 令人印象深刻的地理空间数据抽象库（GDAL，发音为“GOODALL”
  # 或Goodle的）。更多信息GDAL在http://www.gdal.org。
  #
  # MapServer4.x版可以读取并显示位图（如GIF格式），RGB/ A（真
  # 色）和多光谱（超过3个波段的图像，像原材料的LandSat
  # 图像）栅格。
  LAYER # MODIS raster layer begins here
    NAME         modis
    DATA         "raster/mod09a12003161_ugl_ll_8bit.tif"
    STATUS       OFF
    TYPE         RASTER
    PROCESSING   "BANDS=1,2,3"
    OFFSITE      71 74 65
  END # MODIS raster layer ends here

  LAYER # States line layer begins here
    NAME         states_line
    DATA         states_ugl
    STATUS       OFF
    TYPE         LINE

    CLASSITEM    "CLASS"
    CLASS
      NAME       'State Boundary'
      EXPRESSION 'land'
      STYLE
        SYMBOL     'line5'
        COLOR      64 64 64
        SIZE       1
      END
    END
  END # States line layer ends here

  # Labels can be defined in its own layer.  This is useful if, say, you want
  # to label a polygon layer that's covered by another layer.  By keeping the
  # label separate from the polygon and placing it near the bottom of the map
  # file (so its drawn on, or near the, top), you can still see the label even
  # though you might not be able to see the polygon.  It is also a good
  # alternate to point symbols.
  #
  # A label layer is actually defined with ANNOTATION type (This is derived from
  # points, Node IDs for lines, or polygon IDs).
  # 标签中可以在自己的层被定义。这是非常有用的，如果说，你想，
  # 标记另一层覆盖的多边形的层。通过保持
  # 从多边形分开的标签，并把它放在底部附近的地图
  # 文件（其上绘制或附近，顶部），你仍然可以看到标签
  # 虽然你可能无法看到多边形。这也是一个很好的
  # 候补点符号。
  #
  # 标签层实际上是定义注释类型（这是来自
  # 点，线，或多边形的ID的节点ID）。
  LAYER # States label layer begins here
    NAME         states_label
    DATA         states_ugl
    STATUS       OFF
    TYPE         ANNOTATION

    CLASSITEM    "CLASS"

    # Just like CLASSITEM, LABELITEM defines the database attribute that you
    # will be using to draw labels.  In this case, the values of the attribute
    # "STATE" will be used to label the states polygons.
    # 就像CLASSITEM，LABELITEM定义您被用来绘制标签的数据库属性。
    # 在这种情况下，“STATE”属性的值
    # 将被用于标记国家多边形。
    LABELITEM    "STATE"

    CLASS
      EXPRESSION 'land'
      STYLE
        COLOR      -1 -1 -1
      END

      # There can be labels in a class, just like there are classes in a layer,
      # just like there are layers in a map.  You can define multiple labels in
      # a class just as you can define multiple classes in a layer and multiple
      # layers in a map.
      # MapServer has a very flexible labeling system.  With that flexibility
      # comes complexity, specially when using truetype fonts.  Please read
      # through the LABEL section of the MapServer map file documentation at
      # http://www.mapserver.org/mapfile for more information.
      # 可以在一个类中有多个标签，就像有一层中有多个类，
      # 就像在一个地图中有多个层。您可以在一类中定义多个标签
      # ，就像你在一层，可以定义多个类，在一个地图中定义多个
      # 层。
      # MapServer的有一个非常灵活的标签制度。灵活性
      # 自变得复杂，特别是当使用TrueType字体时。请
      # 通过MapServer地图文件文档的LABEL段
      # 在http://www.mapserver.org/mapfile阅读更多信息。
      LABEL
        COLOR 132 31 31
        SHADOWCOLOR 218 218 218
        SHADOWSIZE 2 2
        TYPE TRUETYPE
        FONT arial-bold
        SIZE 12
        ANTIALIAS TRUE
        POSITION CL
        PARTIALS FALSE
        MINDISTANCE 300
        BUFFER 4
      END # end of label
      # 标签结束
    END # end of class
    # 类结束
  END # States label layer ends here
  # 国家标签到此结束
  # End of LAYER DEFINITIONS -------------------------------
  # 层定义结束

END # All map files must come to an end just as all other things must come to...
# 所有的地图文件必须结束，就像所有其他的事情，一定要来...

</pre>
          </p>
          <hr align="center" width="300">
          <p><!--The mapfile structure, by objects, looks like this:-->mapfile的结构，通过对象，看起来像这样：</p>
          <pre>
                                               MAP
               LAYER #1-------------LAYER #2----|----LAYER #3--------LAYER #4
            (states_poly)           (modis)       (states_line)   (states_label)
               |                                     |               |
  (land) CLASS-|-CLASS (water)                       |-CLASS         |-CLASS
             |   |                                     |                 |
       STYLE-|   |-STYLE                               |-STYLE     STYLE-|-LABEL

</pre>

          <hr align="center" width="300">
          <p align="left"><!--When you look at the mapfile, you'll see that the new
            LAYER object is added below (after) the state POLYGON layer. Why?
            MapServer displays layers in reverse order--last in, first out
            (LIFO). The first layer defined in the mapfile is drawn at the
            bottom of the map.-->
            当你在映射文件，你会看到，新的添加层对象（后）状态多边形层。
            为什么呢？MapServer以相反的顺序显示层 - 后进先出（LIFO）。
            第一层绘制在映射文件中定义在地图的底部。
          </p>
          <p><!--So, if we have drawn the state POLYGON layer, it would be on the
            bottom. Since the raster layer gets drawn on top of it, we won't
            see it. That's why the first layer gets the STATUS value of OFF.
            The state LINE layer is defined below the raster layer so it gets
            drawn on top (and you can see it). This is why we separated the
            state LINE layer from the state POLYGON layer. Of course the labels
            get drawn on top of everything.-->
            所以，如果我们已制定国家多边形层，它会在底部。
            由于光栅层被绘制在它的上面，我们不会看到它。
            这就是为什么第一层得到关闭的状态值。国行层定义如下光栅层，所以它得到顶部绘制（你可以看到它）。
            这就是为什么我们从国家多边形层分离国家线层。当然，标签绘制在一切之上。
          </p>
          <p><!--MapServer can automatically turn layers on or off based on the
            status of other layers--say you want the states polygon layer
            turned off when the raster layer is turned on.  This is done by
            using the REQUIRES parameter.  Keep this in mind as you might want
            to use it once you start creating your own MapServer applications.-->
            MapServer的可以自动开启层或关闭的基础上，其他层的状态 - 说你想要的状态多边形层关闭时的光栅层被打开。
            这是通过使用要件参数。请记住这一点，你可能想使用它，一旦你开始创建自己的地图服务器应用程序。
          </p>
          <p><!--Let's have a look at the new parameters introduced in the
            mapfile:-->
            让我们一起来看看在映射文件介绍的新参数：
          </p>
          <p>IMAGETYPE<br>
            <!--This is not new but the value &quot;PNG24&quot; is. PNG24 is the
            24-bit or true-color version of the PNG format. Instead of being
            limited to 256 color combinations for our output image, MapServer
            now have millions. By the way, try changing this value back to PNG.
            Notice the time it takes to generate the image using either formats.
            In choosing between true color and indexed color, take into account
            the time it takes to generate the image.-->
            这是不是新的，但值是“PNG24”。 
            PNG24是24位真彩色版本的PNG格式。而不是被有限的256颜色组合的输出图像，
            地图服务器现在有几百万。顺便说一下，尝试改变这个值回PNG。
            注意可以使用的格式，生成图像所花费的时间。
            在真彩色和索引颜色之间选择，考虑到生成图像所花费的时间。
          </p>
          <p>SYMBOLSET<br>
            <!--Points to the path of the symbol definition file. The symbols in
            this file are referenced by the SYMBOL parameter in the CLASS
            object. It's not really needed at this point but I thought I'd
            throw this here now. Please refer to the
            <a href="http://www.mapserver.org/mapfile/symbol.html">
              mapfile reference
            </a> and the <a href="http://www.mapserver.org/mapfile/symbology/construction.html">
            Cartographic Symbol Construction with MapServer</a> for further information.-->
            分中的符号定义的文件的路径。此文件中的符号通过类对象中的SYMBOL对象参考。
            在这一点上这不是真正需要的，但我想我会现在在这里抛出这个。
            请参阅<a href="http://www.mapserver.org/mapfile/symbol.html">的映射文件参考</a>，
            并在<a href="http://www.mapserver.org/mapfile/symbology/construction.html">的MapServer的建设与制图符号</A>了解更多信息。
          </p>
          <p>DATA &quot;raster/mod09a12003161_ugl_ll_8bit.tif&quot;<br>
            <!--In the newly added LAYER object, the DATA parameter points to a
            GeoTIFF image. Like vector datasets, MapServer supports multiple
            raster file formats. This support is accomplished through use of
            the GDAL library. For more information on the different raster
            formats supported by MapServer and for general discussion on the
            use of rasters in MapServer, please read the RASTER Data how-to at
            <a href="http://www.mapserver.org/input/raster.html">
              http://www.mapserver.org/input/raster.html
            </a>.-->
            在新添加的层对象，数据参数指向一个GeoTIFF的图像。 MapServer的矢量数据集一样，支持多个光栅文件格式。
            这种支持是通过使用GDAL库。欲了解更多信息，不同的光栅格式支持MapServer和一般性讨论使用栅格地图服务器，请阅读的栅格数据如何在
            <a href="http://www.mapserver.org/input/raster.html">http://www.mapserver.org/input/raster.html</A>

          </p>


          <p>TYPE RASTER<br>
           <!-- When using raster data (images) we use the value RASTER for the
            parameter TYPE, as opposed to the POLYGON, LINE, and POINT values
            for vector data and ANNOTATION for label IDs.-->
            当使用栅格数据（图像），我们使用值栅格参数类型，而不是多边形，线条和点值矢量数据和注释标签的ID。
          </p>
          <p>PROCESSING &quot;BANDS=1,2,3&quot;<br>
            <!--This LAYER object parameter is new in MapServer 4.x. The PROCESSING
            keyword has many values but in this case we are using it to select
            which bands in a multispectral image to display. The values here
            are strings that will be passed to the GDAL library. Documentation
            for this is currently minimal but please see the Mapfile Reference
            for more examples of using the PROCESSING keyword.</p>-->
            这层对象参数地图服务器4.x中是新的。加工的关键字有很多的值，但在这种情况下，我们都用它来选择波段多光谱图像显示。这里的值字符串将被传递给GDAL库。用于这的文档目前是最小的，但是请参阅MAPFILE更多使用加工关键字的例子。
          <p> OFFSITE<br>
            <!--This parameters tells MapServer what pixel values to render as
            background (or ignore). You can get the pixel values using image
            processing or image manipulation programs (i.e. Imagine, Photoshop,
            Gimp).-->
            此参数告诉MapServer的像素值呈现为背景（或忽略）。你可以得到利用图像的像素值处理或图像处理程序（即想象的，Photoshop中，瘸子）。
          </p>
          <hr align="center" width="300">
          <p><!--To compare map creation speed when using RGB image as opposed to
            indexed color image, replace the following lines in the mapfile:-->
            当使用RGB图像，比较地图创建速度而不是要索引彩色图像，替换映射文件中的以下行：
          </p>
          <p>DATA &quot;raster/mod09a12003161_ugl_ll_8bit.tif&quot;<br>
            STATUS DEFAULT <br>
            TYPE RASTER <br>
            PROCESSING &quot;BANDS=1,2,3&quot; <br>
            OFFSITE 71 74 65
          </p>
          <p><!--with these:-->有了这些</p>
          <p>DATA &quot;raster/mod09a12003161_ugl_ll_idxa.tif&quot;<br>
            STATUS DEFAULT <br>
            TYPE RASTER<br>
            OFFSITE 70 74 66</p>
          <p><!--Also, try changing the IMAGETYPE from PNG24 to PNG.-->
           另外，尝试改变IMAGETYPE从PNG24到PNG。
          </p>
          <hr>
          <p class="Small" align="center">
            <a href="example1-4.html">
              Back to Example 1.4
            </a> |
            <a href="section1.html">
              Back to the Section 1
            </a> |
            <a href="sections.html">
              Back to the Sections Page
            </a> |
            <a href="example1-6.html">
              Proceed to Example 1.6
            </a>
          </p>
        </div>
    </div>
{% end %}
